<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uhiha</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <button class="btn btn-primary mb-3" onclick="showAddModal()">Tambah Data</button>
        
        <div class="row" id="wrap_group"></div>
    </div>

    <div class="modal fade" id="addModal" tabindex="-1" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Group Baru</h5>
                    <button type="button" class="close" onclick="hideAddModal()">
                        <span>&times;</span>
                    </button>
                </div>
                <form id="addForm">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Nama Group</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Deskripsi</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="hideAddModal()">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const get_wrap_group = document.getElementById('wrap_group');
        const get_group = fetch('http://localhost/php-template/api/apigroupdelete.php')
        get_group.then(response => response.json()).then(respon => {
            const data = respon.data
            data.forEach(function (row) {
                const show_group = `<div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    ${row.id}
                </div>
                <div class="card-body">
                    <h5 class="card-title">${row.name}</h5>
                    <p class="card-text">${row.description}</p>
                    <button class="btn btn-sm btn-danger" onclick="deleteGroup(${row.id})">HAPUS</button>
                </div>
            </div>
        </div>`

                get_wrap_group.innerHTML += show_group;
            });
        });

        async function deleteGroup(id) {
            const formdata = new FormData();
            formdata.append("id", id);

            const response = await fetch('http://localhost/php-template/api/apigroupdelete.php', {
                method: 'POST',
                body: formdata
            });
            location.reload();
        }

        function showAddModal() {
            const modal = document.getElementById('addModal');
            modal.style.display = 'block';
            modal.classList.add('show');
            
            const backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop fade show';
            document.body.appendChild(backdrop);
            document.body.classList.add('modal-open');
        }

        function hideAddModal() {
            const modal = document.getElementById('addModal');

            modal.style.display = 'none';
            modal.classList.remove('show');
            
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
            document.body.classList.remove('modal-open');
        }

        document.getElementById('addForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = this;
            const formdata = new FormData(form);
            
            const response = await fetch('http://localhost/php-template/api/apigroupadd.php', {
                method: 'POST',
                body: formdata
            });
            
            const result = await response.json();
            
            if (result.status) {
                alert('Data berhasil ditambah!');
                hideAddModal(); 
                form.reset(); 
                location.reload();
            } else {
                alert('Gagal: ' + result.message);
            }
        });

    </script>
</body>
</html>